{
  "version": 3,
  "sources": ["../bundle-0oruRV/checked-fetch.js", "../../../node_modules/@cloudflare/actors/packages/storage/src/sql-schema-migrations.ts", "../../../node_modules/@cloudflare/actors/packages/storage/src/index.ts", "../../../src/index.ts", "../../../node_modules/wrangler/templates/middleware/middleware-ensure-req-body-drained.ts", "../../../node_modules/wrangler/templates/middleware/middleware-miniflare3-json-error.ts", "../bundle-0oruRV/middleware-insertion-facade.js", "../../../node_modules/wrangler/templates/middleware/common.ts", "../bundle-0oruRV/middleware-loader.entry.ts"],
  "sourceRoot": "C:\\Users\\user\\Documents\\project\\astra-games\\ftses\\astra-quiz-dash-main\\src\\server\\.wrangler\\tmp\\dev-EEryGO",
  "sourcesContent": ["const urls = new Set();\n\nfunction checkURL(request, init) {\n\tconst url =\n\t\trequest instanceof URL\n\t\t\t? request\n\t\t\t: new URL(\n\t\t\t\t\t(typeof request === \"string\"\n\t\t\t\t\t\t? new Request(request, init)\n\t\t\t\t\t\t: request\n\t\t\t\t\t).url\n\t\t\t\t);\n\tif (url.port && url.port !== \"443\" && url.protocol === \"https:\") {\n\t\tif (!urls.has(url.toString())) {\n\t\t\turls.add(url.toString());\n\t\t\tconsole.warn(\n\t\t\t\t`WARNING: known issue with \\`fetch()\\` requests to custom HTTPS ports in published Workers:\\n` +\n\t\t\t\t\t` - ${url.toString()} - the custom port will be ignored when the Worker is published using the \\`wrangler deploy\\` command.\\n`\n\t\t\t);\n\t\t}\n\t}\n}\n\nglobalThis.fetch = new Proxy(globalThis.fetch, {\n\tapply(target, thisArg, argArray) {\n\t\tconst [request, init] = argArray;\n\t\tcheckURL(request, init);\n\t\treturn Reflect.apply(target, thisArg, argArray);\n\t},\n});\n", null, null, "import { Storage } from \"@cloudflare/actors/storage\";\r\n\r\nexport interface Env {\r\n  USER_STATE: DurableObjectNamespace;\r\n}\r\n\r\ntype WordleStats = {\r\n  attempts?: number;\r\n  lastWord?: string;\r\n};\r\n\r\ntype GameStats = {\r\n  gamesPlayed: number;\r\n  gamesWon: number;\r\n  totalTime: number;\r\n  wordle?: WordleStats;\r\n  sudoku?: {\r\n    lastSessionId?: string;\r\n    lastDifficulty?: \"easy\" | \"medium\" | \"hard\";\r\n  };\r\n  quiz?: Record<string, unknown>;\r\n};\r\n\r\n// Quiz models (client-visible)\r\ntype QuizQuestion = {\r\n  id: string;\r\n  category: string;\r\n  difficulty: string;\r\n  question: string;\r\n  options: string[]; // length 4\r\n  coinsReward: number;\r\n};\r\n\r\ntype QuizAssists = {\r\n  fifty: number; // 50:50 assists used\r\n  freeze: number; // freeze assists used\r\n};\r\n\r\ntype QuizSessionState = \"active\" | \"ended\";\r\n\r\ntype QuizSession = {\r\n  id: string;\r\n  userId: string;\r\n  questionOrder: number[]; // indices into quiz pool\r\n  pointer: number; // current question index pointer\r\n  lives: number;\r\n  score: number;\r\n  coinsEarned: number;\r\n  assistsUsed: QuizAssists;\r\n  createdAt: string;\r\n  updatedAt: string;\r\n  state: QuizSessionState;\r\n  // Server-only fields below must NEVER be sent to clients\r\n  _server?: {\r\n    perQuestion: Record<number, { correctIndex: number; optionShuffle: number[] }>;\r\n    freezeUntil?: number; // epoch ms; block stacking\r\n    lastAssistTimestamps?: number[]; // rate limit assists\r\n  };\r\n};\r\n\r\ntype WordleSession = {\r\n  gameId: string;\r\n  word: string;\r\n  startedAt: string;\r\n  expiresAt: string;\r\n  attempts: number;\r\n  guessTimestamps: number[];\r\n  revealedPositions?: number[];\r\n};\r\n\r\ntype UserRecord = {\r\n  userId: string;\r\n  name: string;\r\n  coins: number;\r\n  stats: GameStats;\r\n  createdAt: string;\r\n  updatedAt: string;\r\n  wordleSession?: WordleSession;\r\n  hintUses?: number;\r\n  searchUses?: number;\r\n  // Quiz data\r\n  quizSession?: QuizSession;\r\n};\r\n\r\nconst ALLOWED_ORIGINS = new Set([\r\n  \"http://localhost:5173\",\r\n  \"http://localhost:8080\",\r\n  \"http://localhost:8081\",\r\n  \"http://127.0.0.1:5173\",\r\n  \"http://127.0.0.1:8080\",\r\n  \"http://127.0.0.1:8081\",\r\n]);\r\n\r\nconst VALID_WORDS = [\r\n  \"ABOUT\", \"ABOVE\", \"ABUSE\", \"ACTOR\", \"ACUTE\", \"ADMIT\", \"ADOPT\", \"ADULT\", \"AFTER\", \"AGAIN\",\r\n  \"AGENT\", \"AGREE\", \"AHEAD\", \"ALARM\", \"ALBUM\", \"ALERT\", \"ALIKE\", \"ALIVE\", \"ALLOW\", \"ALONE\",\r\n  \"ALONG\", \"ALTER\", \"ANGEL\", \"ANGER\", \"ANGLE\", \"ANGRY\", \"APART\", \"APPLE\", \"APPLY\", \"ARENA\",\r\n  \"ARGUE\", \"ARISE\", \"ARRAY\", \"ASIDE\", \"ASSET\", \"AUDIO\", \"AVOID\", \"AWAKE\", \"AWARD\", \"AWARE\",\r\n  \"BADLY\", \"BAKER\", \"BASES\", \"BASIC\", \"BASIS\", \"BEACH\", \"BEGAN\", \"BEGIN\", \"BEGUN\", \"BEING\",\r\n  \"BELOW\", \"BENCH\", \"BILLY\", \"BIRTH\", \"BLACK\", \"BLADE\", \"BLAME\", \"BLIND\", \"BLOCK\", \"BLOOD\",\r\n  \"BOARD\", \"BOOST\", \"BOOTH\", \"BOUND\", \"BRAIN\", \"BRAND\", \"BREAD\", \"BREAK\", \"BREED\", \"BRIEF\",\r\n  \"BRING\", \"BROAD\", \"BROKE\", \"BROWN\", \"BUILD\", \"BUILT\", \"BUYER\", \"CABLE\", \"CALIF\", \"CARRY\",\r\n  \"CATCH\", \"CAUSE\", \"CHAIN\", \"CHAIR\", \"CHART\", \"CHASE\", \"CHEAP\", \"CHECK\", \"CHEST\", \"CHIEF\",\r\n  \"CHILD\", \"CHINA\", \"CHOSE\", \"CIVIL\", \"CLAIM\", \"CLASS\", \"CLEAN\", \"CLEAR\", \"CLICK\", \"CLOCK\",\r\n  \"CLOSE\", \"COACH\", \"COAST\", \"COULD\", \"COUNT\", \"COURT\", \"COVER\", \"CRACK\", \"CRAFT\", \"CRASH\",\r\n  \"CRAZY\", \"CREAM\", \"CRIME\", \"CROSS\", \"CROWD\", \"CROWN\", \"CRUDE\", \"CURVE\", \"CYCLE\", \"DAILY\",\r\n  \"DANCE\", \"DATED\", \"DEALT\", \"DEATH\", \"DEBUT\", \"DELAY\", \"DEPTH\", \"DOING\", \"DOUBT\", \"DOZEN\",\r\n  \"DRAFT\", \"DRAMA\", \"DRANK\", \"DRAWN\", \"DREAM\", \"DRESS\", \"DRILL\", \"DRINK\", \"DRIVE\", \"DROVE\",\r\n  \"DYING\", \"EAGER\", \"EARLY\", \"EARTH\", \"EIGHT\", \"ELITE\", \"EMPTY\", \"ENEMY\", \"ENJOY\", \"ENTER\",\r\n  \"ENTRY\", \"EQUAL\", \"ERROR\", \"EVENT\", \"EVERY\", \"EXACT\", \"EXIST\", \"EXTRA\", \"FAITH\", \"FALSE\",\r\n  \"FAULT\", \"FIBER\", \"FIELD\", \"FIFTH\", \"FIFTY\", \"FIGHT\", \"FINAL\", \"FIRST\", \"FIXED\", \"FLASH\",\r\n  \"FLEET\", \"FLOOR\", \"FLUID\", \"FOCUS\", \"FORCE\", \"FORTH\", \"FORTY\", \"FORUM\", \"FOUND\", \"FRAME\",\r\n  \"FRANK\", \"FRAUD\", \"FRESH\", \"FRONT\", \"FRUIT\", \"FULLY\", \"FUNNY\", \"GIANT\", \"GIVEN\", \"GLASS\",\r\n  \"GLOBE\", \"GOING\", \"GRACE\", \"GRADE\", \"GRAND\", \"GRANT\", \"GRASS\", \"GREAT\", \"GREEN\", \"GROSS\",\r\n  \"GROUP\", \"GROWN\", \"GUARD\", \"GUESS\", \"GUEST\", \"GUIDE\", \"HAPPY\", \"HARRY\", \"HEART\", \"HEAVY\",\r\n  \"HENCE\", \"HENRY\", \"HORSE\", \"HOTEL\", \"HOUSE\", \"HUMAN\", \"IDEAL\", \"IMAGE\", \"INDEX\", \"INNER\",\r\n  \"INPUT\", \"ISSUE\", \"JAPAN\", \"JIMMY\", \"JOINT\", \"JONES\", \"JUDGE\", \"KNOWN\", \"LABEL\", \"LARGE\",\r\n  \"LASER\", \"LATER\", \"LAUGH\", \"LAYER\", \"LEARN\", \"LEASE\", \"LEAST\", \"LEAVE\", \"LEGAL\", \"LEMON\",\r\n  \"LEVEL\", \"LEWIS\", \"LIGHT\", \"LIMIT\", \"LINKS\", \"LIVES\", \"LOCAL\", \"LOGIC\", \"LOOSE\", \"LOWER\",\r\n  \"LUCKY\", \"LUNCH\", \"LYING\", \"MAGIC\", \"MAJOR\", \"MAKER\", \"MARCH\", \"MARIA\", \"MATCH\", \"MAYBE\",\r\n  \"MAYOR\", \"MEANT\", \"MEDIA\", \"METAL\", \"MIGHT\", \"MINOR\", \"MINUS\", \"MIXED\", \"MODEL\", \"MONEY\",\r\n  \"MONTH\", \"MORAL\", \"MOTOR\", \"MOUNT\", \"MOUSE\", \"MOUTH\", \"MOVIE\", \"MUSIC\", \"NEEDS\", \"NEVER\",\r\n  \"NEWLY\", \"NIGHT\", \"NOISE\", \"NORTH\", \"NOTED\", \"NOVEL\", \"NURSE\", \"OCCUR\", \"OCEAN\", \"OFFER\",\r\n  \"OFTEN\", \"ORDER\", \"OTHER\", \"OUGHT\", \"PAINT\", \"PANEL\", \"PAPER\", \"PARTY\", \"PEACE\", \"PETER\",\r\n  \"PHASE\", \"PHONE\", \"PHOTO\", \"PIECE\", \"PILOT\", \"PITCH\", \"PLACE\", \"PLAIN\", \"PLANE\", \"PLANT\",\r\n  \"PLATE\", \"POINT\", \"POUND\", \"POWER\", \"PRESS\", \"PRICE\", \"PRIDE\", \"PRIME\", \"PRINT\", \"PRIOR\",\r\n  \"PRIZE\", \"PROOF\", \"PROUD\", \"PROVE\", \"QUEEN\", \"QUICK\", \"QUIET\", \"QUITE\", \"RADIO\", \"RAISE\",\r\n  \"RANGE\", \"RAPID\", \"RATIO\", \"REACH\", \"READY\", \"REFER\", \"RIGHT\", \"RIVAL\", \"RIVER\", \"ROBIN\",\r\n  \"ROGER\", \"ROMAN\", \"ROUGH\", \"ROUND\", \"ROUTE\", \"ROYAL\", \"RURAL\", \"SCALE\", \"SCENE\", \"SCOPE\",\r\n  \"SCORE\", \"SENSE\", \"SERVE\", \"SEVEN\", \"SHALL\", \"SHAPE\", \"SHARE\", \"SHARP\", \"SHEET\", \"SHELF\",\r\n  \"SHELL\", \"SHIFT\", \"SHINE\", \"SHIRT\", \"SHOCK\", \"SHOOT\", \"SHORT\", \"SHOWN\", \"SIGHT\", \"SINCE\",\r\n  \"SIXTH\", \"SIXTY\", \"SIZED\", \"SKILL\", \"SLEEP\", \"SLIDE\", \"SMALL\", \"SMART\", \"SMILE\", \"SMITH\",\r\n  \"SMOKE\", \"SOLID\", \"SOLVE\", \"SORRY\", \"SOUND\", \"SOUTH\", \"SPACE\", \"SPARE\", \"SPEAK\", \"SPEED\",\r\n  \"SPEND\", \"SPENT\", \"SPLIT\", \"SPOKE\", \"SPORT\", \"STAFF\", \"STAGE\", \"STAKE\", \"STAND\", \"START\",\r\n  \"STATE\", \"STEAM\", \"STEEL\", \"STICK\", \"STILL\", \"STOCK\", \"STONE\", \"STOOD\", \"STORE\", \"STORM\",\r\n  \"STORY\", \"STRIP\", \"STUCK\", \"STUDY\", \"STUFF\", \"STYLE\", \"SUGAR\", \"SUITE\", \"SUPER\", \"SWEET\",\r\n  \"TABLE\", \"TAKEN\", \"TASTE\", \"TAXES\", \"TEACH\", \"TERRY\", \"TEXAS\", \"THANK\", \"THEFT\", \"THEIR\",\r\n  \"THEME\", \"THERE\", \"THESE\", \"THICK\", \"THING\", \"THINK\", \"THIRD\", \"THOSE\", \"THREE\", \"THREW\",\r\n  \"THROW\", \"TIGHT\", \"TIMES\", \"TITLE\", \"TODAY\", \"TOPIC\", \"TOTAL\", \"TOUCH\", \"TOUGH\", \"TOWER\",\r\n  \"TRACK\", \"TRADE\", \"TRAIN\", \"TREAT\", \"TREND\", \"TRIAL\", \"TRIBE\", \"TRICK\", \"TRIED\", \"TRIES\",\r\n  \"TROOP\", \"TRUCK\", \"TRULY\", \"TRUMP\", \"TRUST\", \"TRUTH\", \"TWICE\", \"UNDER\", \"UNDUE\", \"UNION\",\r\n  \"UNITY\", \"UNTIL\", \"UPPER\", \"URBAN\", \"USAGE\", \"USUAL\", \"VALID\", \"VALUE\", \"VIDEO\", \"VIRUS\",\r\n  \"VISIT\", \"VITAL\", \"VOCAL\", \"VOICE\", \"WASTE\", \"WATCH\", \"WATER\", \"WHEEL\", \"WHERE\", \"WHICH\",\r\n  \"WHILE\", \"WHITE\", \"WHOLE\", \"WHOSE\", \"WOMAN\", \"WOMEN\", \"WORLD\", \"WORRY\", \"WORSE\", \"WORST\",\r\n  \"WORTH\", \"WOULD\", \"WOUND\", \"WRITE\", \"WRONG\", \"WROTE\", \"YOUNG\", \"YOUTH\"\r\n];\r\n\r\nconst SESSION_DURATION_MS = 70_000; // 70 seconds per session\r\nconst RATE_LIMIT_WINDOW_MS = 60_000; // 1 minute window\r\nconst RATE_LIMIT_MAX_GUESSES = 20; // max guesses per window per user\r\nconst MAX_WORDLE_ATTEMPTS = 6;\r\nconst FREE_HINTS = 3;\r\nconst FREE_SEARCHES = 3;\r\nconst PAID_ACTION_COST = 10;\r\n\r\n// Quiz constants\r\nconst QUIZ_FREE_FIFTY = 2;\r\nconst QUIZ_FREE_FREEZE = 2;\r\nconst QUIZ_COST_FIFTY = 20;\r\nconst QUIZ_COST_FREEZE = 10;\r\nconst QUIZ_LIVES = 3;\r\nconst QUIZ_RATE_LIMIT_WINDOW_MS = 30_000; // 30s window\r\nconst QUIZ_RATE_LIMIT_MAX_ASSISTS = 3; // max assists per window\r\nconst QUIZ_FREEZE_SECONDS = 8;\r\nconst QUIZ_OPTIONS_COUNT = 4;\r\nconst QUIZ_ROUND_QUESTIONS = 10;\r\n\r\nconst DEFAULT_NAME = \"Player\";\r\nconst STORAGE_KEY = \"record\";\r\n\r\nfunction isObject(value: unknown): value is Record<string, unknown> {\r\n  return typeof value === \"object\" && value !== null && !Array.isArray(value);\r\n}\r\n\r\nfunction deepMerge<T extends Record<string, any>>(target: T, patch: Partial<T>): T {\r\n  for (const [key, value] of Object.entries(patch)) {\r\n    const current = (target as Record<string, unknown>)[key];\r\n    if (isObject(current) && isObject(value)) {\r\n      (target as Record<string, unknown>)[key] = deepMerge({ ...current }, value) as unknown as T[keyof T];\r\n    } else if (value !== undefined) {\r\n      (target as Record<string, unknown>)[key] = value as T[keyof T];\r\n    }\r\n  }\r\n}\r\n\r\nfunction isValidWordFromList(word: string): boolean {\r\n  return VALID_WORDS.includes(word.toUpperCase());\r\n}\r\n\r\nfunction hashString(input: string): number {\r\n  let hash = 0;\r\n  for (let i = 0; i < input.length; i += 1) {\r\n    hash = (hash * 31 + input.charCodeAt(i)) >>> 0;\r\n  }\r\n  return hash;\r\n}\r\n\r\nfunction randomWord(): string {\r\n  const idx = randomIndex(VALID_WORDS.length);\r\n  return VALID_WORDS[idx];\r\n}\r\n\r\nfunction randomIndex(maxExclusive: number): number {\r\n  const bytes = new Uint32Array(1);\r\n  crypto.getRandomValues(bytes);\r\n  return bytes[0] % maxExclusive;\r\n}\r\n\r\nfunction shuffleArray<T>(arr: T[]): T[] {\r\n  const copy = arr.slice();\r\n  for (let i = copy.length - 1; i > 0; i -= 1) {\r\n    const j = randomIndex(i + 1);\r\n    const tmp = copy[i];\r\n    copy[i] = copy[j];\r\n    copy[j] = tmp;\r\n  }\r\n  return copy;\r\n}\r\n\r\nfunction revealLetterUnique(session: WordleSession): { letter: string; position: number } {\r\n  const word = session.word;\r\n  const revealed = new Set(session.revealedPositions ?? []);\r\n  const available: number[] = [];\r\n  for (let i = 0; i < word.length; i += 1) {\r\n    if (!revealed.has(i)) available.push(i);\r\n  }\r\n\r\n  // If all positions are revealed, just return a consistent last hint (e.g., first position)\r\n  const position = available.length > 0 ? available[randomIndex(available.length)] : 0;\r\n  return { letter: word[position], position };\r\n}\r\n\r\nfunction isSessionActive(session: WordleSession | undefined, now: number): boolean {\r\n  if (!session) return false;\r\n  const expiresAt = Date.parse(session.expiresAt);\r\n  return now < expiresAt;\r\n}\r\n\r\nfunction remainingMs(session: WordleSession | undefined, now: number): number {\r\n  if (!session) return 0;\r\n  return Math.max(0, Date.parse(session.expiresAt) - now);\r\n}\r\n\r\ntype LetterResult = \"correct\" | \"present\" | \"absent\";\r\n\r\nfunction updateWordleStats(record: UserRecord, session: WordleSession, victory: boolean, finishedAtMs: number): void {\r\n  const started = Date.parse(session.startedAt);\r\n  const duration = Math.max(0, Math.min(finishedAtMs - started, SESSION_DURATION_MS));\r\n  record.stats.gamesPlayed = (record.stats.gamesPlayed ?? 0) + 1;\r\n  if (victory) {\r\n    record.stats.gamesWon = (record.stats.gamesWon ?? 0) + 1;\r\n  }\r\n  record.stats.totalTime = (record.stats.totalTime ?? 0) + duration;\r\n  record.stats.wordle = {\r\n    ...(record.stats.wordle ?? {}),\r\n    attempts: session.attempts,\r\n    lastWord: session.word,\r\n  };\r\n}\r\n\r\ntype AllowanceKind = \"hint\" | \"search\";\r\n\r\nfunction consumeAllowance(record: UserRecord, kind: AllowanceKind): { charged: boolean; remainingFree: number } {\r\n  const key = kind === \"hint\" ? \"hintUses\" : \"searchUses\";\r\n  const freeCap = kind === \"hint\" ? FREE_HINTS : FREE_SEARCHES;\r\n  const current = (record as any)[key] ?? 0;\r\n  if (current < freeCap) {\r\n    (record as any)[key] = current + 1;\r\n    return { charged: false, remainingFree: freeCap - (current + 1) };\r\n  }\r\n  if (record.coins < PAID_ACTION_COST) {\r\n    throw new Error(\"Insufficient coins for this action\");\r\n  }\r\n  record.coins -= PAID_ACTION_COST;\r\n  (record as any)[key] = current + 1;\r\n  return { charged: true, remainingFree: 0 };\r\n}\r\n\r\nfunction evaluateGuess(guess: string, target: string): LetterResult[] {\r\n  const result: LetterResult[] = Array(guess.length).fill(\"absent\");\r\n  const targetCounts: Record<string, number> = {};\r\n\r\n  for (let i = 0; i < target.length; i += 1) {\r\n    const t = target[i];\r\n    if (guess[i] === t) {\r\n      result[i] = \"correct\";\r\n    } else {\r\n      targetCounts[t] = (targetCounts[t] || 0) + 1;\r\n    }\r\n  }\r\n\r\n  for (let i = 0; i < target.length; i += 1) {\r\n    if (result[i] === \"correct\") continue;\r\n    const g = guess[i];\r\n    if (targetCounts[g] > 0) {\r\n      result[i] = \"present\";\r\n      targetCounts[g] -= 1;\r\n    }\r\n  }\r\n\r\n  return result;\r\n}\r\n\r\nfunction enforceRateLimit(session: WordleSession, now: number): void {\r\n  session.guessTimestamps = session.guessTimestamps.filter((ts) => now - ts <= RATE_LIMIT_WINDOW_MS);\r\n  if (session.guessTimestamps.length >= RATE_LIMIT_MAX_GUESSES) {\r\n    throw new Error(\"Too many guesses; please slow down.\");\r\n  }\r\n  session.guessTimestamps.push(now);\r\n}\r\n\r\nfunction responseHeaders(origin: string | null): Headers {\r\n  const headers = new Headers({\r\n    \"Content-Type\": \"application/json\",\r\n    \"Access-Control-Allow-Methods\": \"GET,POST,OPTIONS\",\r\n    \"Access-Control-Allow-Headers\": \"Content-Type, x-user-id\",\r\n  });\r\n  if (!origin) {\r\n    headers.set(\"Access-Control-Allow-Origin\", \"*\");\r\n  } else if (ALLOWED_ORIGINS.has(origin)) {\r\n    headers.set(\"Access-Control-Allow-Origin\", origin);\r\n  }\r\n  return headers;\r\n}\r\n\r\nfunction jsonResponse(body: unknown, status: number, origin: string | null): Response {\r\n  return new Response(JSON.stringify(body), { status, headers: responseHeaders(origin) });\r\n}\r\n\r\nfunction badRequest(message: string, origin: string | null): Response {\r\n  return jsonResponse({ error: message }, 400, origin);\r\n}\r\n\r\nfunction handleOptions(request: Request): Response {\r\n  const origin = request.headers.get(\"Origin\");\r\n  const headers = responseHeaders(origin);\r\n  headers.set(\"Access-Control-Max-Age\", \"86400\");\r\n  return new Response(null, { status: 204, headers });\r\n}\r\n\r\nfunction normalizeUser(record: UserRecord): UserRecord {\r\n  return {\r\n    ...record,\r\n    name: record.name || DEFAULT_NAME,\r\n    hintUses: record.hintUses ?? 0,\r\n    searchUses: record.searchUses ?? 0,\r\n    stats: {\r\n      gamesPlayed: record.stats.gamesPlayed ?? 0,\r\n      gamesWon: record.stats.gamesWon ?? 0,\r\n      totalTime: record.stats.totalTime ?? 0,\r\n      wordle: record.stats.wordle ?? {},\r\n      sudoku: record.stats.sudoku ?? {},\r\n      quiz: record.stats.quiz ?? {},\r\n    },\r\n    wordleSession: record.wordleSession\r\n      ? {\r\n          ...record.wordleSession,\r\n          guessTimestamps: record.wordleSession.guessTimestamps ?? [],\r\n        }\r\n      : undefined,\r\n    quizSession: record.quizSession\r\n      ? {\r\n          ...record.quizSession,\r\n          _server: record.quizSession._server ?? { perQuestion: {}, lastAssistTimestamps: [] },\r\n        }\r\n      : undefined,\r\n  };\r\n}\r\n\r\nfunction sanitizeUserForResponse(record: UserRecord, nowMs: number): UserRecord {\r\n  const normalized = normalizeUser(record);\r\n  const session = normalized.wordleSession;\r\n  return {\r\n    ...normalized,\r\n    wordleSession: session\r\n      ? {\r\n          gameId: session.gameId,\r\n          wordLength: session.word.length,\r\n          startedAt: session.startedAt,\r\n          expiresAt: session.expiresAt,\r\n          attempts: session.attempts,\r\n          guessTimestamps: session.guessTimestamps,\r\n          remainingTime: remainingMs(session, nowMs),\r\n        } as any\r\n      : undefined,\r\n    quizSession: normalized.quizSession\r\n      ? {\r\n          id: normalized.quizSession.id,\r\n          userId: normalized.quizSession.userId,\r\n          questionOrder: normalized.quizSession.questionOrder,\r\n          pointer: normalized.quizSession.pointer,\r\n          lives: normalized.quizSession.lives,\r\n          score: normalized.quizSession.score,\r\n          coinsEarned: normalized.quizSession.coinsEarned,\r\n          assistsUsed: normalized.quizSession.assistsUsed,\r\n          createdAt: normalized.quizSession.createdAt,\r\n          updatedAt: normalized.quizSession.updatedAt,\r\n          state: normalized.quizSession.state,\r\n        } as any\r\n      : undefined,\r\n  };\r\n}\r\n\r\n// In-memory quiz pool; server holds correctIndex but never returns it\r\nconst QUIZ_POOL_INTERNAL: Array<QuizQuestion & { correctIndex: number }> = [\r\n  {\r\n    id: \"q1\",\r\n    category: \"general\",\r\n    difficulty: \"easy\",\r\n    question: \"Which planet is known as the Red Planet?\",\r\n    options: [\"Earth\", \"Mars\", \"Venus\", \"Jupiter\"],\r\n    coinsReward: 5,\r\n    correctIndex: 1,\r\n  },\r\n  {\r\n    id: \"q2\",\r\n    category: \"tech\",\r\n    difficulty: \"medium\",\r\n    question: \"What does CPU stand for?\",\r\n    options: [\"Central Process Unit\", \"Central Processing Unit\", \"Computer Personal Unit\", \"Compute Power Unit\"],\r\n    coinsReward: 5,\r\n    correctIndex: 1,\r\n  },\r\n  {\r\n    id: \"q3\",\r\n    category: \"science\",\r\n    difficulty: \"easy\",\r\n    question: \"H2O is the chemical formula for what?\",\r\n    options: [\"Oxygen\", \"Hydrogen\", \"Water\", \"Helium\"],\r\n    coinsReward: 5,\r\n    correctIndex: 2,\r\n  },\r\n  // Additional general knowledge questions\r\n  { id: \"q4\", category: \"general\", difficulty: \"easy\", question: \"What is the capital of France?\", options: [\"Berlin\", \"Madrid\", \"Paris\", \"Rome\"], coinsReward: 5, correctIndex: 2 },\r\n  { id: \"q5\", category: \"general\", difficulty: \"easy\", question: \"Which animal is the largest land animal?\", options: [\"Giraffe\", \"Elephant\", \"Hippopotamus\", \"Rhino\"], coinsReward: 5, correctIndex: 1 },\r\n  { id: \"q6\", category: \"general\", difficulty: \"easy\", question: \"How many continents are there on Earth?\", options: [\"5\", \"6\", \"7\", \"8\"], coinsReward: 5, correctIndex: 2 },\r\n  { id: \"q7\", category: \"general\", difficulty: \"easy\", question: \"Which ocean is the largest?\", options: [\"Atlantic\", \"Indian\", \"Pacific\", \"Arctic\"], coinsReward: 5, correctIndex: 2 },\r\n  { id: \"q8\", category: \"general\", difficulty: \"easy\", question: \"Which country invented pizza?\", options: [\"France\", \"Spain\", \"Italy\", \"Greece\"], coinsReward: 5, correctIndex: 2 },\r\n  { id: \"q9\", category: \"general\", difficulty: \"easy\", question: \"What is the tallest mountain in the world?\", options: [\"K2\", \"Mount Everest\", \"Kilimanjaro\", \"Denali\"], coinsReward: 5, correctIndex: 1 },\r\n  { id: \"q10\", category: \"general\", difficulty: \"easy\", question: \"Which instrument has keys, pedals, and strings?\", options: [\"Guitar\", \"Piano\", \"Violin\", \"Flute\"], coinsReward: 5, correctIndex: 1 },\r\n  { id: \"q11\", category: \"general\", difficulty: \"easy\", question: \"What gas do plants absorb from the atmosphere?\", options: [\"Oxygen\", \"Nitrogen\", \"Carbon Dioxide\", \"Helium\"], coinsReward: 5, correctIndex: 2 },\r\n  { id: \"q12\", category: \"general\", difficulty: \"easy\", question: \"Which language has the most native speakers?\", options: [\"English\", \"Spanish\", \"Mandarin Chinese\", \"Hindi\"], coinsReward: 5, correctIndex: 2 },\r\n  { id: \"q13\", category: \"general\", difficulty: \"easy\", question: \"What is the hardest natural substance?\", options: [\"Gold\", \"Iron\", \"Diamond\", \"Quartz\"], coinsReward: 5, correctIndex: 2 },\r\n  { id: \"q14\", category: \"general\", difficulty: \"easy\", question: \"Which planet has the most moons?\", options: [\"Earth\", \"Mars\", \"Jupiter\", \"Saturn\"], coinsReward: 5, correctIndex: 2 },\r\n  { id: \"q15\", category: \"general\", difficulty: \"easy\", question: \"Which country hosts the city of Tokyo?\", options: [\"China\", \"South Korea\", \"Japan\", \"Thailand\"], coinsReward: 5, correctIndex: 2 },\r\n  { id: \"q16\", category: \"general\", difficulty: \"easy\", question: \"What is the chemical symbol for gold?\", options: [\"Ag\", \"Au\", \"Gd\", \"Go\"], coinsReward: 5, correctIndex: 1 },\r\n  { id: \"q17\", category: \"general\", difficulty: \"easy\", question: \"Which sport is known as the 'king of sports'?\", options: [\"Basketball\", \"Cricket\", \"Soccer (Football)\", \"Tennis\"], coinsReward: 5, correctIndex: 2 },\r\n  { id: \"q18\", category: \"general\", difficulty: \"easy\", question: \"Which continent is the Sahara Desert located on?\", options: [\"Asia\", \"Africa\", \"Australia\", \"South America\"], coinsReward: 5, correctIndex: 1 },\r\n  { id: \"q19\", category: \"general\", difficulty: \"easy\", question: \"What is the largest mammal?\", options: [\"Elephant\", \"Blue Whale\", \"Giraffe\", \"Orca\"], coinsReward: 5, correctIndex: 1 },\r\n  { id: \"q20\", category: \"general\", difficulty: \"easy\", question: \"Which country is famous for the Taj Mahal?\", options: [\"Pakistan\", \"India\", \"Bangladesh\", \"Nepal\"], coinsReward: 5, correctIndex: 1 },\r\n  { id: \"q21\", category: \"general\", difficulty: \"easy\", question: \"Which fruit is known for keeping doctors away?\", options: [\"Banana\", \"Orange\", \"Apple\", \"Pear\"], coinsReward: 5, correctIndex: 2 },\r\n  { id: \"q22\", category: \"general\", difficulty: \"easy\", question: \"What is the capital of Australia?\", options: [\"Sydney\", \"Melbourne\", \"Canberra\", \"Perth\"], coinsReward: 5, correctIndex: 2 },\r\n  { id: \"q23\", category: \"general\", difficulty: \"easy\", question: \"Which part of the plant conducts photosynthesis?\", options: [\"Roots\", \"Stem\", \"Leaves\", \"Flowers\"], coinsReward: 5, correctIndex: 2 },\r\n  { id: \"q24\", category: \"general\", difficulty: \"easy\", question: \"Which metal is liquid at room temperature?\", options: [\"Mercury\", \"Aluminum\", \"Iron\", \"Copper\"], coinsReward: 5, correctIndex: 0 },\r\n  { id: \"q25\", category: \"general\", difficulty: \"easy\", question: \"Which continent is the smallest by land area?\", options: [\"Europe\", \"Australia\", \"Antarctica\", \"South America\"], coinsReward: 5, correctIndex: 1 },\r\n  { id: \"q26\", category: \"general\", difficulty: \"easy\", question: \"What is the main ingredient in guacamole?\", options: [\"Tomato\", \"Avocado\", \"Pepper\", \"Onion\"], coinsReward: 5, correctIndex: 1 },\r\n  { id: \"q27\", category: \"general\", difficulty: \"easy\", question: \"Which country is known as the Land of the Rising Sun?\", options: [\"China\", \"Japan\", \"Vietnam\", \"Philippines\"], coinsReward: 5, correctIndex: 1 },\r\n  { id: \"q28\", category: \"general\", difficulty: \"easy\", question: \"What is the largest planet in our solar system?\", options: [\"Earth\", \"Saturn\", \"Jupiter\", \"Neptune\"], coinsReward: 5, correctIndex: 2 },\r\n  { id: \"q29\", category: \"general\", difficulty: \"easy\", question: \"Which element do humans and animals need to breathe?\", options: [\"Hydrogen\", \"Oxygen\", \"Carbon\", \"Nitrogen\"], coinsReward: 5, correctIndex: 1 },\r\n  { id: \"q30\", category: \"general\", difficulty: \"easy\", question: \"Which country gifted the Statue of Liberty to the USA?\", options: [\"United Kingdom\", \"France\", \"Spain\", \"Germany\"], coinsReward: 5, correctIndex: 1 },\r\n  { id: \"q31\", category: \"general\", difficulty: \"easy\", question: \"What is the largest desert in the world?\", options: [\"Gobi\", \"Sahara\", \"Antarctic Desert\", \"Arabian\"], coinsReward: 5, correctIndex: 2 },\r\n  { id: \"q32\", category: \"general\", difficulty: \"easy\", question: \"Which scientist proposed the theory of relativity?\", options: [\"Isaac Newton\", \"Albert Einstein\", \"Nikola Tesla\", \"Galileo Galilei\"], coinsReward: 5, correctIndex: 1 },\r\n  { id: \"q33\", category: \"general\", difficulty: \"easy\", question: \"Which organ pumps blood through the body?\", options: [\"Lungs\", \"Heart\", \"Liver\", \"Kidneys\"], coinsReward: 5, correctIndex: 1 },\r\n  { id: \"q34\", category: \"general\", difficulty: \"easy\", question: \"Which continent is home to the Amazon rainforest?\", options: [\"Africa\", \"Asia\", \"South America\", \"Australia\"], coinsReward: 5, correctIndex: 2 },\r\n  { id: \"q35\", category: \"general\", difficulty: \"easy\", question: \"What is the boiling point of water at sea level?\", options: [\"90\u00B0C\", \"100\u00B0C\", \"110\u00B0C\", \"120\u00B0C\"], coinsReward: 5, correctIndex: 1 },\r\n  { id: \"q36\", category: \"general\", difficulty: \"easy\", question: \"Which country is known for the pyramids of Giza?\", options: [\"Mexico\", \"Egypt\", \"Peru\", \"Sudan\"], coinsReward: 5, correctIndex: 1 },\r\n  { id: \"q37\", category: \"general\", difficulty: \"easy\", question: \"Which animal is known as the King of the Jungle?\", options: [\"Tiger\", \"Lion\", \"Leopard\", \"Jaguar\"], coinsReward: 5, correctIndex: 1 },\r\n  { id: \"q38\", category: \"general\", difficulty: \"easy\", question: \"Which gas do humans exhale?\", options: [\"Oxygen\", \"Carbon Dioxide\", \"Nitrogen\", \"Argon\"], coinsReward: 5, correctIndex: 1 },\r\n  { id: \"q39\", category: \"general\", difficulty: \"easy\", question: \"Which city is known as the Big Apple?\", options: [\"Los Angeles\", \"Chicago\", \"New York\", \"Miami\"], coinsReward: 5, correctIndex: 2 },\r\n  { id: \"q40\", category: \"general\", difficulty: \"easy\", question: \"What is the primary language spoken in Brazil?\", options: [\"Spanish\", \"Portuguese\", \"French\", \"English\"], coinsReward: 5, correctIndex: 1 },\r\n];\r\n\r\nfunction filterQuizPool(limit?: number, category?: string, difficulty?: string): QuizQuestion[] {\r\n  let list = QUIZ_POOL_INTERNAL;\r\n  if (category) list = list.filter((q) => q.category === category);\r\n  if (difficulty) list = list.filter((q) => q.difficulty === difficulty);\r\n  if (typeof limit === \"number\" && Number.isFinite(limit)) list = list.slice(0, Math.max(0, limit));\r\n  return list.map(({ correctIndex: _ci, ...rest }) => ({ ...rest }));\r\n}\r\n\r\nfunction sanitizeQuestionForClient(q: QuizQuestion, optionOrder?: number[]): QuizQuestion {\r\n  if (!optionOrder) return q;\r\n  const shuffledOptions = optionOrder.map((i) => q.options[i]);\r\n  return { ...q, options: shuffledOptions };\r\n}\r\n\r\nfunction ensureQuizSessionServerState(session: QuizSession): void {\r\n  if (!session._server) session._server = { perQuestion: {}, lastAssistTimestamps: [] };\r\n  if (!session._server.lastAssistTimestamps) session._server.lastAssistTimestamps = [];\r\n}\r\n\r\nfunction rateLimitAssist(session: QuizSession, now: number): void {\r\n  ensureQuizSessionServerState(session);\r\n  const arr = session._server!.lastAssistTimestamps!;\r\n  const filtered = arr.filter((ts) => now - ts <= QUIZ_RATE_LIMIT_WINDOW_MS);\r\n  session._server!.lastAssistTimestamps = filtered;\r\n  if (filtered.length >= QUIZ_RATE_LIMIT_MAX_ASSISTS) {\r\n    throw new Error(\"Too many assists; please slow down.\");\r\n  }\r\n  filtered.push(now);\r\n}\r\n\r\nfunction getCurrentQuestionIndex(session: QuizSession): number | null {\r\n  if (session.pointer < 0 || session.pointer >= session.questionOrder.length) return null;\r\n  return session.questionOrder[session.pointer] ?? null;\r\n}\r\n\r\nfunction getOrCreateShuffleForQuestion(session: QuizSession, poolIndex: number): number[] {\r\n  ensureQuizSessionServerState(session);\r\n  const entry = session._server!.perQuestion[poolIndex];\r\n  if (entry) return entry.optionShuffle;\r\n  const correctIndex = QUIZ_POOL_INTERNAL[poolIndex].correctIndex;\r\n  const order = shuffleArray([...Array(QUIZ_OPTIONS_COUNT).keys()]);\r\n  session._server!.perQuestion[poolIndex] = { correctIndex, optionShuffle: order };\r\n  return order;\r\n}\r\n\r\nfunction getClientVisibleQuestion(session: QuizSession, poolIndex: number): QuizQuestion {\r\n  const base = filterQuizPool(undefined).find((q) => q.id === QUIZ_POOL_INTERNAL[poolIndex].id)!;\r\n  const order = getOrCreateShuffleForQuestion(session, poolIndex);\r\n  return sanitizeQuestionForClient(base, order);\r\n}\r\n\r\nfunction checkAnswer(session: QuizSession, poolIndex: number, selectedIndex: number): boolean {\r\n  ensureQuizSessionServerState(session);\r\n  const entry = session._server!.perQuestion[poolIndex];\r\n  if (!entry) {\r\n    getOrCreateShuffleForQuestion(session, poolIndex);\r\n  }\r\n  const { correctIndex, optionShuffle } = session._server!.perQuestion[poolIndex];\r\n  const selectedOriginalIndex = optionShuffle[selectedIndex];\r\n  return selectedOriginalIndex === correctIndex;\r\n}\r\n\r\nasync function readJson(request: Request): Promise<any> {\r\n  try {\r\n    return await request.json();\r\n  } catch (err) {\r\n    throw new Error(\"Invalid JSON body\");\r\n  }\r\n}\r\n\r\nfunction validateAmount(value: unknown): number {\r\n  if (typeof value !== \"number\" || !Number.isFinite(value) || value <= 0) {\r\n    throw new Error(\"amount must be a positive number\");\r\n  }\r\n  return value;\r\n}\r\n\r\nfunction nowIso(): string {\r\n  return new Date().toISOString();\r\n}\r\n\r\nfunction createDefaultUser(userId: string): UserRecord {\r\n  const timestamp = nowIso();\r\n  return {\r\n    userId,\r\n    name: DEFAULT_NAME,\r\n    coins: 0,\r\n    stats: {\r\n      gamesPlayed: 0,\r\n      gamesWon: 0,\r\n      totalTime: 0,\r\n      wordle: {},\r\n      sudoku: {},\r\n      quiz: {},\r\n    },\r\n    hintUses: 0,\r\n    searchUses: 0,\r\n    createdAt: timestamp,\r\n    updatedAt: timestamp,\r\n  };\r\n}\r\n\r\nexport default {\r\n  async fetch(request: Request, env: Env): Promise<Response> {\r\n    if (request.method === \"OPTIONS\") {\r\n      return handleOptions(request);\r\n    }\r\n\r\n    const origin = request.headers.get(\"Origin\");\r\n    const url = new URL(request.url);\r\n    const { pathname } = url;\r\n\r\n    // Friendly message for browsers hitting the root without headers.\r\n    if (!pathname.startsWith(\"/api/\")) {\r\n      return new Response(\r\n        \"Astra backend is running. Include 'x-user-id' header on /api requests.\",\r\n        { status: 200, headers: responseHeaders(origin) }\r\n      );\r\n    }\r\n\r\n    let userId = request.headers.get(\"x-user-id\")?.trim();\r\n    let generatedUserId: string | null = null;\r\n\r\n    if (!userId) {\r\n      generatedUserId = crypto.randomUUID();\r\n      userId = generatedUserId;\r\n    }\r\n\r\n    const id = env.USER_STATE.idFromName(userId);\r\n    const stub = env.USER_STATE.get(id);\r\n\r\n    const headers = new Headers(request.headers);\r\n    headers.set(\"x-user-id\", userId);\r\n\r\n    const forwardedRequest = new Request(request, { headers });\r\n    const response = await stub.fetch(forwardedRequest);\r\n\r\n    if (generatedUserId) {\r\n      const newHeaders = new Headers(response.headers);\r\n      newHeaders.set(\"x-user-id\", generatedUserId);\r\n      return new Response(response.body, {\r\n        status: response.status,\r\n        statusText: response.statusText,\r\n        headers: newHeaders,\r\n      });\r\n    }\r\n\r\n    return response;\r\n  },\r\n};\r\n\r\nexport class UserStateSql {\r\n  state: DurableObjectState;\r\n  storage: Storage;\r\n  private migrationsReady: Promise<void>;\r\n\r\n  constructor(state: DurableObjectState) {\r\n    this.state = state;\r\n    this.storage = new Storage(state.storage);\r\n    this.storage.migrations = [\r\n      {\r\n        idMonotonicInc: 1,\r\n        description: \"Create user_records table\",\r\n        sql: \"CREATE TABLE IF NOT EXISTS user_records (id TEXT PRIMARY KEY, data TEXT NOT NULL)\",\r\n      },\r\n      {\r\n        idMonotonicInc: 2,\r\n        description: \"Create sudoku_sessions table\",\r\n        sql: \"CREATE TABLE IF NOT EXISTS sudoku_sessions (id TEXT PRIMARY KEY, payload TEXT NOT NULL)\",\r\n      },\r\n    ];\r\n    this.migrationsReady = this.storage.runMigrations();\r\n  }\r\n\r\n  async fetch(request: Request): Promise<Response> {\r\n    const url = new URL(request.url);\r\n    const { pathname } = url;\r\n    const origin = request.headers.get(\"Origin\");\r\n\r\n    if (request.method === \"OPTIONS\") {\r\n      return handleOptions(request);\r\n    }\r\n\r\n    const userId = request.headers.get(\"x-user-id\")?.trim();\r\n    if (!userId) {\r\n      return badRequest(\"Missing x-user-id header\", origin);\r\n    }\r\n\r\n    try {\r\n      switch (pathname) {\r\n        case \"/api/user/init\":\r\n          if (request.method !== \"POST\") return this.methodNotAllowed(origin);\r\n          return await this.handleInit(userId, origin);\r\n        case \"/api/user\":\r\n          if (request.method !== \"GET\") return this.methodNotAllowed(origin);\r\n          return await this.handleGet(userId, origin);\r\n        case \"/api/coins/add\":\r\n          if (request.method !== \"POST\") return this.methodNotAllowed(origin);\r\n          return await this.handleAddCoins(request, userId, origin);\r\n        case \"/api/coins/spend\":\r\n          if (request.method !== \"POST\") return this.methodNotAllowed(origin);\r\n          return await this.handleSpendCoins(request, userId, origin);\r\n        case \"/api/stats/update\":\r\n          if (request.method !== \"POST\") return this.methodNotAllowed(origin);\r\n          return await this.handleUpdateStats(request, userId, origin);\r\n        case \"/api/wordle/word\":\r\n          if (request.method !== \"GET\") return this.methodNotAllowed(origin);\r\n          return await this.handleWordleWord(userId, origin);\r\n        case \"/api/wordle/validate\":\r\n          if (request.method !== \"POST\") return this.methodNotAllowed(origin);\r\n          return await this.handleWordleValidate(request, userId, origin);\r\n        case \"/api/wordle/hint\":\r\n          if (request.method !== \"POST\") return this.methodNotAllowed(origin);\r\n          return await this.handleWordleAllowance(userId, origin, \"hint\");\r\n        case \"/api/wordle/search\":\r\n          if (request.method !== \"POST\") return this.methodNotAllowed(origin);\r\n          return await this.handleWordleAllowance(userId, origin, \"search\");\r\n        case \"/api/quiz/questions\":\r\n          if (request.method !== \"GET\") return this.methodNotAllowed(origin);\r\n          return await this.handleQuizQuestions(request, userId, origin);\r\n        case \"/api/quiz/session/start\":\r\n          if (request.method !== \"POST\") return this.methodNotAllowed(origin);\r\n          return await this.handleQuizSessionStart(request, userId, origin);\r\n        case \"/api/sudoku/start\":\r\n          if (request.method !== \"POST\") return this.methodNotAllowed(origin);\r\n          return await this.handleSudokuStart(request, userId, origin);\r\n        case \"/api/sudoku/check\":\r\n          if (request.method !== \"POST\") return this.methodNotAllowed(origin);\r\n          return await this.handleSudokuCheck(request, userId, origin);\r\n        case \"/api/sudoku/hint\":\r\n          if (request.method !== \"POST\") return this.methodNotAllowed(origin);\r\n          return await this.handleSudokuHint(request, userId, origin);\r\n        default:\r\n          if (pathname.startsWith(\"/api/quiz/session/\")) {\r\n            const parts = pathname.split(\"/\");\r\n            const id = parts[4];\r\n            const action = parts[5];\r\n            if (!id) return jsonResponse({ error: \"Invalid session id\" }, 400, origin);\r\n            if (request.method !== \"POST\") return this.methodNotAllowed(origin);\r\n            if (action === \"answer\") return await this.handleQuizAnswer(request, userId, origin, id);\r\n            if (action === \"assist\" && parts[6] === \"fifty\") return await this.handleQuizAssistFifty(userId, origin, id);\r\n            if (action === \"assist\" && parts[6] === \"freeze\") return await this.handleQuizAssistFreeze(userId, origin, id);\r\n            if (action === \"skip\") return await this.handleQuizSkip(userId, origin, id);\r\n            if (action === \"end\") return await this.handleQuizEnd(userId, origin, id);\r\n          }\r\n          return jsonResponse({ error: \"Not found\" }, 404, origin);\r\n      }\r\n    } catch (error) {\r\n      const message = error instanceof Error ? error.message : \"Unexpected error\";\r\n      return jsonResponse({ error: message }, 400, origin);\r\n    }\r\n  }\r\n\r\n  private methodNotAllowed(origin: string | null): Response {\r\n    return jsonResponse({ error: \"Method not allowed\" }, 405, origin);\r\n  }\r\n\r\n  private async ensureMigrations(): Promise<void> {\r\n    await this.migrationsReady;\r\n  }\r\n\r\n  private async getRecord(userId: string): Promise<UserRecord> {\r\n    await this.ensureMigrations();\r\n    const rows = await this.storage.sql<{ data: string }>`SELECT data FROM user_records WHERE id = ${STORAGE_KEY} LIMIT 1;`;\r\n    const stored = rows[0]?.data ? (JSON.parse(rows[0].data) as UserRecord) : null;\r\n    if (stored) return normalizeUser(stored);\r\n    const record = createDefaultUser(userId);\r\n    await this.storage.sql`INSERT INTO user_records (id, data) VALUES (${STORAGE_KEY}, ${JSON.stringify(record)});`;\r\n    return record;\r\n  }\r\n\r\n  private async saveRecord(record: UserRecord): Promise<void> {\r\n    await this.ensureMigrations();\r\n    const payload = JSON.stringify(record);\r\n    await this.storage.sql`INSERT INTO user_records (id, data) VALUES (${STORAGE_KEY}, ${payload}) ON CONFLICT(id) DO UPDATE SET data = excluded.data;`;\r\n  }\r\n\r\n  private async handleInit(userId: string, origin: string | null): Promise<Response> {\r\n    const record = await this.getRecord(userId);\r\n    return jsonResponse({ user: sanitizeUserForResponse(record, Date.now()) }, 200, origin);\r\n  }\r\n\r\n  private async handleGet(userId: string, origin: string | null): Promise<Response> {\r\n    const record = await this.getRecord(userId);\r\n    return jsonResponse({ user: sanitizeUserForResponse(record, Date.now()) }, 200, origin);\r\n  }\r\n\r\n  private async handleAddCoins(request: Request, userId: string, origin: string | null): Promise<Response> {\r\n    const body = await readJson(request);\r\n    const amount = validateAmount(body?.amount);\r\n\r\n    const record = await this.getRecord(userId);\r\n    record.coins += amount;\r\n    record.updatedAt = nowIso();\r\n    await this.saveRecord(record);\r\n\r\n    return jsonResponse({ balance: record.coins, user: sanitizeUserForResponse(record, Date.now()) }, 200, origin);\r\n  }\r\n\r\n  private async handleSpendCoins(request: Request, userId: string, origin: string | null): Promise<Response> {\r\n    const body = await readJson(request);\r\n    const amount = validateAmount(body?.amount);\r\n\r\n    const record = await this.getRecord(userId);\r\n    if (record.coins < amount) {\r\n      return jsonResponse({ error: \"Insufficient balance\" }, 400, origin);\r\n    }\r\n\r\n    record.coins -= amount;\r\n    record.updatedAt = nowIso();\r\n    await this.saveRecord(record);\r\n\r\n    return jsonResponse({ balance: record.coins, user: sanitizeUserForResponse(record, Date.now()) }, 200, origin);\r\n  }\r\n\r\n  private async handleUpdateStats(request: Request, userId: string, origin: string | null): Promise<Response> {\r\n    const body = await readJson(request);\r\n    if (!isObject(body)) {\r\n      throw new Error(\"Body must be an object\");\r\n    }\r\n\r\n    const { statsPatch, name } = body as { statsPatch?: Partial<GameStats>; name?: string };\r\n    if (name !== undefined && typeof name !== \"string\") {\r\n      throw new Error(\"name must be a string\");\r\n    }\r\n\r\n    if (statsPatch !== undefined && !isObject(statsPatch)) {\r\n      throw new Error(\"statsPatch must be an object\");\r\n    }\r\n\r\n    const record = await this.getRecord(userId);\r\n\r\n    if (name !== undefined && name.trim().length > 0) {\r\n      record.name = name.trim();\r\n    }\r\n\r\n    if (statsPatch) {\r\n      record.stats = deepMerge(record.stats, statsPatch);\r\n    }\r\n\r\n    record.updatedAt = nowIso();\r\n    await this.saveRecord(record);\r\n\r\n    return jsonResponse({ user: record }, 200, origin);\r\n  }\r\n\r\n  private async handleWordleWord(userId: string, origin: string | null): Promise<Response> {\r\n    const record = await this.getRecord(userId);\r\n    const now = Date.now();\r\n    const active = record.wordleSession;\r\n\r\n    if (active && isSessionActive(active, now)) {\r\n      const remaining = remainingMs(active, now);\r\n      return jsonResponse(\r\n        {\r\n          gameId: active.gameId,\r\n          wordLength: active.word.length,\r\n          remainingTime: remaining,\r\n          resumed: true,\r\n        },\r\n        200,\r\n        origin\r\n      );\r\n    }\r\n\r\n    const word = randomWord();\r\n    const gameId = crypto.randomUUID();\r\n    const startedAt = new Date(now).toISOString();\r\n    const expiresAt = new Date(now + SESSION_DURATION_MS).toISOString();\r\n\r\n    record.wordleSession = {\r\n      gameId,\r\n      word,\r\n      startedAt,\r\n      expiresAt,\r\n      attempts: 0,\r\n      guessTimestamps: [],\r\n      revealedPositions: [],\r\n    };\r\n    record.updatedAt = nowIso();\r\n    await this.saveRecord(record);\r\n\r\n    return jsonResponse({ gameId, wordLength: word.length, remainingTime: SESSION_DURATION_MS }, 200, origin);\r\n  }\r\n\r\n  private async handleWordleValidate(request: Request, userId: string, origin: string | null): Promise<Response> {\r\n    const body = await readJson(request);\r\n    const guessRaw = typeof body?.guess === \"string\" ? body.guess.trim() : \"\";\r\n    const gameId = typeof body?.gameId === \"string\" ? body.gameId.trim() : undefined;\r\n\r\n    if (!guessRaw) {\r\n      return jsonResponse({ error: \"guess is required\" }, 400, origin);\r\n    }\r\n\r\n    const guess = guessRaw.toUpperCase();\r\n    if (guess.length !== 5 || /[^A-Z]/.test(guess)) {\r\n      return jsonResponse({ error: \"guess must be 5 letters\" }, 400, origin);\r\n    }\r\n    if (!isValidWordFromList(guess)) {\r\n      return jsonResponse({ error: \"guess is not in word list\" }, 400, origin);\r\n    }\r\n\r\n    const record = await this.getRecord(userId);\r\n    const session = record.wordleSession;\r\n    const now = Date.now();\r\n\r\n    if (!session) {\r\n      return jsonResponse({ error: \"No active session\" }, 409, origin);\r\n    }\r\n\r\n    if (gameId && session.gameId !== gameId) {\r\n      return jsonResponse({ error: \"Mismatched gameId\" }, 409, origin);\r\n    }\r\n\r\n    if (!isSessionActive(session, now)) {\r\n      record.wordleSession = undefined;\r\n      record.updatedAt = nowIso();\r\n      await this.saveRecord(record);\r\n      return jsonResponse({ error: \"Session expired\", target: session.word }, 410, origin);\r\n    }\r\n\r\n    try {\r\n      enforceRateLimit(session, now);\r\n    } catch (err) {\r\n      return jsonResponse({ error: (err as Error).message }, 429, origin);\r\n    }\r\n\r\n    session.attempts += 1;\r\n    const result = evaluateGuess(guess, session.word);\r\n    const victory = result.every((r) => r === \"correct\");\r\n\r\n    if (victory) {\r\n      updateWordleStats(record, session, true, now);\r\n      record.wordleSession = undefined;\r\n      record.updatedAt = nowIso();\r\n      await this.saveRecord(record);\r\n      return jsonResponse({ result, victory: true, target: session.word }, 200, origin);\r\n    }\r\n\r\n    const remainingTime = remainingMs(session, now);\r\n    if (remainingTime <= 0) {\r\n      updateWordleStats(record, session, false, now);\r\n      record.wordleSession = undefined;\r\n      record.updatedAt = nowIso();\r\n      await this.saveRecord(record);\r\n      return jsonResponse({ error: \"Session expired\", target: session.word }, 410, origin);\r\n    }\r\n\r\n    if (session.attempts >= MAX_WORDLE_ATTEMPTS) {\r\n      const target = session.word;\r\n      updateWordleStats(record, session, false, now);\r\n      record.wordleSession = undefined;\r\n      record.updatedAt = nowIso();\r\n      await this.saveRecord(record);\r\n      return jsonResponse({ result, victory: false, target, remainingTime }, 200, origin);\r\n    }\r\n\r\n    record.wordleSession = session;\r\n    record.updatedAt = nowIso();\r\n    await this.saveRecord(record);\r\n\r\n    return jsonResponse({ result, victory: false, remainingTime }, 200, origin);\r\n  }\r\n\r\n  private async handleWordleAllowance(\r\n    userId: string,\r\n    origin: string | null,\r\n    kind: AllowanceKind\r\n  ): Promise<Response> {\r\n    const record = await this.getRecord(userId);\r\n    const now = Date.now();\r\n\r\n    // Require active session to prevent abuse\r\n    const session = record.wordleSession;\r\n    if (!session || !isSessionActive(session, now)) {\r\n      return jsonResponse({ error: \"No active session\" }, 409, origin);\r\n    }\r\n\r\n    try {\r\n      const { charged, remainingFree } = consumeAllowance(record, kind);\r\n      const { letter, position } = revealLetterUnique(session);\r\n      // Track revealed position to avoid duplicates in subsequent hints\r\n      session.revealedPositions = Array.from(new Set([...(session.revealedPositions ?? []), position]));\r\n      record.updatedAt = nowIso();\r\n      await this.saveRecord(record);\r\n      const basePayload = {\r\n        ok: true,\r\n        charged,\r\n        remainingFree,\r\n        balance: record.coins,\r\n        user: sanitizeUserForResponse(record, now),\r\n        letter,\r\n      };\r\n\r\n      if (kind === \"hint\") {\r\n        return jsonResponse({ ...basePayload, position }, 200, origin);\r\n      }\r\n\r\n      return jsonResponse(basePayload, 200, origin);\r\n    } catch (err) {\r\n      return jsonResponse({ error: (err as Error).message }, 400, origin);\r\n    }\r\n  }\r\n\r\n  // --- Sudoku helpers & endpoints ---\r\n  private generateCompleteGrid(): number[][] {\r\n    const grid: (number | null)[][] = Array(9)\r\n      .fill(null)\r\n      .map(() => Array(9).fill(null));\r\n\r\n    // Fill diagonal 3x3 boxes with shuffled digits\r\n    for (let box = 0; box < 9; box += 3) {\r\n      const nums = [1, 2, 3, 4, 5, 6, 7, 8, 9];\r\n      for (let i = 0; i < 3; i++) {\r\n        for (let j = 0; j < 3; j++) {\r\n          const idx = randomIndex(nums.length);\r\n          grid[box + i][box + j] = nums[idx];\r\n          nums.splice(idx, 1);\r\n        }\r\n      }\r\n    }\r\n\r\n    const isValid = (g: (number | null)[][], r: number, c: number, n: number): boolean => {\r\n      for (let x = 0; x < 9; x++) {\r\n        if (g[r][x] === n) return false;\r\n        if (g[x][c] === n) return false;\r\n      }\r\n      const br = Math.floor(r / 3) * 3;\r\n      const bc = Math.floor(c / 3) * 3;\r\n      for (let i = 0; i < 3; i++) {\r\n        for (let j = 0; j < 3; j++) {\r\n          if (g[br + i][bc + j] === n) return false;\r\n        }\r\n      }\r\n      return true;\r\n    };\r\n\r\n    const solve = (g: (number | null)[][]): boolean => {\r\n      for (let r = 0; r < 9; r++) {\r\n        for (let c = 0; c < 9; c++) {\r\n          if (g[r][c] === null) {\r\n            for (let n = 1; n <= 9; n++) {\r\n              if (isValid(g, r, c, n)) {\r\n                g[r][c] = n;\r\n                if (solve(g)) return true;\r\n                g[r][c] = null;\r\n              }\r\n            }\r\n            return false;\r\n          }\r\n        }\r\n      }\r\n      return true;\r\n    };\r\n\r\n    solve(grid);\r\n    return grid.map((row) => row.map((x) => x as number));\r\n  }\r\n\r\n  private generatePuzzle(difficulty: \"easy\" | \"medium\" | \"hard\"): { puzzle: (number | null)[][]; solution: number[][] } {\r\n    const solution = this.generateCompleteGrid();\r\n    const puzzle: (number | null)[][] = solution.map((row) => row.map((n) => n));\r\n    const cellsToRemove = difficulty === \"easy\" ? 35 : difficulty === \"medium\" ? 45 : 55;\r\n    let removed = 0;\r\n    while (removed < cellsToRemove) {\r\n      const r = randomIndex(9);\r\n      const c = randomIndex(9);\r\n      if (puzzle[r][c] !== null) {\r\n        puzzle[r][c] = null;\r\n        removed++;\r\n      }\r\n    }\r\n    return { puzzle, solution };\r\n  }\r\n\r\n  private sudokuStorageKey(sessionId: string): string {\r\n    return `sudoku:${sessionId}`;\r\n  }\r\n\r\n  private async saveSudokuSession(session: { id: string; difficulty: \"easy\" | \"medium\" | \"hard\"; puzzle: (number | null)[][]; solution: number[][]; createdAt: string }): Promise<void> {\r\n    await this.ensureMigrations();\r\n    const key = this.sudokuStorageKey(session.id);\r\n    const payload = JSON.stringify(session);\r\n    await this.storage.sql`INSERT INTO sudoku_sessions (id, payload) VALUES (${key}, ${payload}) ON CONFLICT(id) DO UPDATE SET payload = excluded.payload;`;\r\n  }\r\n\r\n  private async loadSudokuSession(sessionId: string): Promise<{ id: string; difficulty: \"easy\" | \"medium\" | \"hard\"; puzzle: (number | null)[][]; solution: number[][]; createdAt: string } | null> {\r\n    await this.ensureMigrations();\r\n    const key = this.sudokuStorageKey(sessionId);\r\n    const rows = await this.storage.sql<{ payload: string }>`SELECT payload FROM sudoku_sessions WHERE id = ${key} LIMIT 1;`;\r\n    const payload = rows[0]?.payload;\r\n    return payload ? (JSON.parse(payload) as { id: string; difficulty: \"easy\" | \"medium\" | \"hard\"; puzzle: (number | null)[][]; solution: number[][]; createdAt: string }) : null;\r\n  }\r\n\r\n  private async handleSudokuStart(request: Request, userId: string, origin: string | null): Promise<Response> {\r\n    const body = await readJson(request);\r\n    const difficulty = body?.difficulty as (\"easy\" | \"medium\" | \"hard\") | undefined;\r\n    if (!difficulty || ![\"easy\", \"medium\", \"hard\"].includes(difficulty)) {\r\n      return badRequest(\"Invalid difficulty\", origin);\r\n    }\r\n\r\n    const { puzzle, solution } = this.generatePuzzle(difficulty);\r\n    const sessionId = crypto.randomUUID();\r\n    const createdAt = nowIso();\r\n  await this.saveSudokuSession({ id: sessionId, difficulty, puzzle, solution, createdAt });\r\n\r\n    const record = await this.getRecord(userId);\r\n    record.stats.sudoku = { lastSessionId: sessionId, lastDifficulty: difficulty };\r\n    record.updatedAt = nowIso();\r\n    await this.saveRecord(record);\r\n\r\n    const time = difficulty === \"easy\" ? 300 : difficulty === \"medium\" ? 180 : 120;\r\n    return jsonResponse({ sessionId, puzzle, time }, 200, origin);\r\n  }\r\n\r\n  private async handleSudokuCheck(request: Request, _userId: string, origin: string | null): Promise<Response> {\r\n    const body = await readJson(request);\r\n    const sessionId = body?.sessionId as string;\r\n    const grid = body?.grid as (number | null)[][];\r\n    if (!sessionId || !Array.isArray(grid) || grid.length !== 9) {\r\n      return badRequest(\"Invalid payload\", origin);\r\n    }\r\n\r\n    const session = await this.loadSudokuSession(sessionId);\r\n    if (!session) return jsonResponse({ error: \"Session not found\" }, 404, origin);\r\n\r\n    const invalid: string[] = [];\r\n    let complete = true;\r\n    for (let r = 0; r < 9; r++) {\r\n      for (let c = 0; c < 9; c++) {\r\n        const cur = grid[r][c];\r\n        if (cur === null) complete = false;\r\n        if (cur !== null && cur !== session.solution[r][c]) {\r\n          invalid.push(`${r}-${c}`);\r\n        }\r\n      }\r\n    }\r\n\r\n    const correctSoFar = invalid.length === 0;\r\n    const solved = correctSoFar && complete;\r\n    return jsonResponse({ invalidCells: invalid, correctSoFar, complete: solved }, 200, origin);\r\n  }\r\n\r\n  private async handleSudokuHint(request: Request, _userId: string, origin: string | null): Promise<Response> {\r\n    const body = await readJson(request);\r\n    const sessionId = body?.sessionId as string;\r\n    const grid = body?.grid as (number | null)[][];\r\n    if (!sessionId || !Array.isArray(grid) || grid.length !== 9) {\r\n      return badRequest(\"Invalid payload\", origin);\r\n    }\r\n\r\n    const session = await this.loadSudokuSession(sessionId);\r\n    if (!session) return jsonResponse({ error: \"Session not found\" }, 404, origin);\r\n\r\n    const empties: Array<[number, number]> = [];\r\n    for (let r = 0; r < 9; r++) {\r\n      for (let c = 0; c < 9; c++) {\r\n        if (grid[r][c] === null) empties.push([r, c]);\r\n      }\r\n    }\r\n\r\n    if (empties.length === 0) {\r\n      return jsonResponse({ message: \"No empty cells\" }, 200, origin);\r\n    }\r\n\r\n    const [row, col] = empties[randomIndex(empties.length)];\r\n    const value = session.solution[row][col];\r\n    return jsonResponse({ row, col, value }, 200, origin);\r\n  }\r\n\r\n  // Quiz: GET questions pool (without answers); shuffle options per-session\r\n  private async handleQuizQuestions(request: Request, userId: string, origin: string | null): Promise<Response> {\r\n    const url = new URL(request.url);\r\n    const limitParam = url.searchParams.get(\"limit\");\r\n    const category = url.searchParams.get(\"category\") ?? undefined;\r\n    const difficulty = url.searchParams.get(\"difficulty\") ?? undefined;\r\n    const limit = limitParam ? Number(limitParam) : undefined;\r\n\r\n    const record = await this.getRecord(userId);\r\n    const session = record.quizSession;\r\n\r\n    // No active session: return filtered pool honoring limit\r\n    if (!session) {\r\n      const pool = filterQuizPool(limit, category ?? undefined, difficulty ?? undefined);\r\n      return jsonResponse({ questions: pool }, 200, origin);\r\n    }\r\n\r\n    // Active session: lock to the session's question order to keep option shuffles aligned\r\n    const pool = filterQuizPool(undefined, category ?? undefined, difficulty ?? undefined);\r\n    const order = session.questionOrder ?? [];\r\n    const limitedOrder = typeof limit === \"number\" && Number.isFinite(limit)\r\n      ? order.slice(0, Math.max(0, limit))\r\n      : order;\r\n\r\n    const mapped: QuizQuestion[] = limitedOrder\r\n      .map((idx) => {\r\n        const base = pool[idx] ?? QUIZ_POOL_INTERNAL[idx];\r\n        if (!base) return null;\r\n        const shuffle = getOrCreateShuffleForQuestion(session, idx);\r\n        return sanitizeQuestionForClient(base, shuffle);\r\n      })\r\n      .filter((q): q is QuizQuestion => Boolean(q));\r\n\r\n    record.updatedAt = nowIso();\r\n    await this.saveRecord(record);\r\n    return jsonResponse({ questions: mapped }, 200, origin);\r\n  }\r\n\r\n  // Quiz: start session, spend coins entry, init question order\r\n  private async handleQuizSessionStart(request: Request, userId: string, origin: string | null): Promise<Response> {\r\n    const body = await readJson(request);\r\n    const entryCost = validateAmount(body?.entryCost ?? 0);\r\n\r\n    const record = await this.getRecord(userId);\r\n    if (record.coins < entryCost) {\r\n      return jsonResponse({ error: \"Insufficient balance\" }, 400, origin);\r\n    }\r\n    record.coins -= entryCost;\r\n\r\n    const totalQuestions = QUIZ_POOL_INTERNAL.length;\r\n    const order = shuffleArray([...Array(totalQuestions).keys()]).slice(0, QUIZ_ROUND_QUESTIONS);\r\n    const now = Date.now();\r\n    const session: QuizSession = {\r\n      id: crypto.randomUUID(),\r\n      userId,\r\n      questionOrder: order,\r\n      pointer: 0,\r\n      lives: QUIZ_LIVES,\r\n      score: 0,\r\n      coinsEarned: 0,\r\n      assistsUsed: { fifty: 0, freeze: 0 },\r\n      createdAt: new Date(now).toISOString(),\r\n      updatedAt: new Date(now).toISOString(),\r\n      state: \"active\",\r\n      _server: { perQuestion: {}, lastAssistTimestamps: [] },\r\n    };\r\n\r\n    record.quizSession = session;\r\n    record.updatedAt = nowIso();\r\n    await this.saveRecord(record);\r\n\r\n    const clientSession = sanitizeUserForResponse(record, now).quizSession;\r\n    return jsonResponse({ session: clientSession, balance: record.coins }, 200, origin);\r\n  }\r\n\r\n  // Quiz: submit answer for current pointer\r\n  private async handleQuizAnswer(request: Request, userId: string, origin: string | null, sessionId: string): Promise<Response> {\r\n    const body = await readJson(request);\r\n    const selectedIndex = typeof body?.selectedIndex === \"number\" ? body.selectedIndex : undefined;\r\n    if (selectedIndex === undefined || selectedIndex < 0 || selectedIndex >= QUIZ_OPTIONS_COUNT) {\r\n      return jsonResponse({ error: \"selectedIndex out of range\" }, 400, origin);\r\n    }\r\n\r\n    const record = await this.getRecord(userId);\r\n    const session = record.quizSession;\r\n    if (!session || session.state !== \"active\" || session.id !== sessionId) {\r\n      return jsonResponse({ error: \"No active session\" }, 409, origin);\r\n    }\r\n\r\n    const poolIndex = getCurrentQuestionIndex(session);\r\n    if (poolIndex === null) {\r\n      session.state = \"ended\";\r\n      record.updatedAt = nowIso();\r\n      await this.saveRecord(record);\r\n      return jsonResponse({ error: \"Session has no questions\", done: true }, 400, origin);\r\n    }\r\n\r\n    const correct = checkAnswer(session, poolIndex, selectedIndex);\r\n    const reward = correct ? QUIZ_POOL_INTERNAL[poolIndex].coinsReward : 0;\r\n    if (correct) {\r\n      session.score += 1;\r\n      session.coinsEarned += reward;\r\n      record.coins += reward;\r\n    } else {\r\n      session.lives = Math.max(0, session.lives - 1);\r\n    }\r\n\r\n    // advance pointer or end\r\n    session.pointer += 1;\r\n    const done = session.pointer >= session.questionOrder.length || session.lives <= 0;\r\n    if (done) session.state = \"ended\";\r\n    session.updatedAt = nowIso();\r\n    record.updatedAt = nowIso();\r\n    await this.saveRecord(record);\r\n\r\n    return jsonResponse({\r\n      correct,\r\n      lives: session.lives,\r\n      score: session.score,\r\n      coinsEarned: session.coinsEarned,\r\n      pointer: session.pointer,\r\n      done,\r\n      balance: record.coins,\r\n    }, 200, origin);\r\n  }\r\n\r\n  // Quiz: 50:50 assist - return two indices to hide (wrong options); free first two uses, then charge\r\n  private async handleQuizAssistFifty(userId: string, origin: string | null, sessionId: string): Promise<Response> {\r\n    const record = await this.getRecord(userId);\r\n    const session = record.quizSession;\r\n    const now = Date.now();\r\n    if (!session || session.state !== \"active\" || session.id !== sessionId) {\r\n      return jsonResponse({ error: \"No active session\" }, 409, origin);\r\n    }\r\n    rateLimitAssist(session, now);\r\n\r\n    const poolIndex = getCurrentQuestionIndex(session);\r\n    if (poolIndex === null) return jsonResponse({ error: \"No current question\" }, 400, origin);\r\n\r\n    // Charge if beyond free uses\r\n    let charged = false;\r\n    if (session.assistsUsed.fifty >= QUIZ_FREE_FIFTY) {\r\n      if (record.coins < QUIZ_COST_FIFTY) return jsonResponse({ error: \"Insufficient balance\" }, 400, origin);\r\n      record.coins -= QUIZ_COST_FIFTY;\r\n      charged = true;\r\n    }\r\n    session.assistsUsed.fifty += 1;\r\n\r\n    const mapping = getOrCreateShuffleForQuestion(session, poolIndex);\r\n    const correctOriginal = session._server!.perQuestion[poolIndex].correctIndex;\r\n    // Build list of wrong indices in client-shuffled space\r\n    const wrongClientIndices: number[] = [];\r\n    for (let i = 0; i < QUIZ_OPTIONS_COUNT; i += 1) {\r\n      const orig = mapping[i];\r\n      if (orig !== correctOriginal) wrongClientIndices.push(i);\r\n    }\r\n    const hide = shuffleArray(wrongClientIndices).slice(0, 2);\r\n\r\n    record.updatedAt = nowIso();\r\n    await this.saveRecord(record);\r\n    return jsonResponse({ indices: hide, charged, remainingFree: Math.max(0, QUIZ_FREE_FIFTY - session.assistsUsed.fifty) + (charged ? 0 : 0), balance: record.coins }, 200, origin);\r\n  }\r\n\r\n  // Quiz: freeze timer for 8s; prevent stacking\r\n  private async handleQuizAssistFreeze(userId: string, origin: string | null, sessionId: string): Promise<Response> {\r\n    const record = await this.getRecord(userId);\r\n    const session = record.quizSession;\r\n    const now = Date.now();\r\n    if (!session || session.state !== \"active\" || session.id !== sessionId) {\r\n      return jsonResponse({ error: \"No active session\" }, 409, origin);\r\n    }\r\n    rateLimitAssist(session, now);\r\n\r\n    ensureQuizSessionServerState(session);\r\n    if (session._server!.freezeUntil && now < session._server!.freezeUntil) {\r\n      return jsonResponse({ error: \"Freeze already active\" }, 429, origin);\r\n    }\r\n\r\n    let charged = false;\r\n    if (session.assistsUsed.freeze >= QUIZ_FREE_FREEZE) {\r\n      if (record.coins < QUIZ_COST_FREEZE) return jsonResponse({ error: \"Insufficient balance\" }, 400, origin);\r\n      record.coins -= QUIZ_COST_FREEZE;\r\n      charged = true;\r\n    }\r\n    session.assistsUsed.freeze += 1;\r\n    session._server!.freezeUntil = now + QUIZ_FREEZE_SECONDS * 1000;\r\n    session.updatedAt = nowIso();\r\n    record.updatedAt = nowIso();\r\n    await this.saveRecord(record);\r\n\r\n    return jsonResponse({ freezeSeconds: QUIZ_FREEZE_SECONDS, charged, balance: record.coins }, 200, origin);\r\n  }\r\n\r\n  // Quiz: skip current question (move to end)\r\n  private async handleQuizSkip(userId: string, origin: string | null, sessionId: string): Promise<Response> {\r\n    const record = await this.getRecord(userId);\r\n    const session = record.quizSession;\r\n    if (!session || session.state !== \"active\" || session.id !== sessionId) {\r\n      return jsonResponse({ error: \"No active session\" }, 409, origin);\r\n    }\r\n    const poolIndex = getCurrentQuestionIndex(session);\r\n    if (poolIndex === null) return jsonResponse({ error: \"No current question\" }, 400, origin);\r\n\r\n    // Move current question to end and advance pointer\r\n    const current = session.questionOrder.splice(session.pointer, 1)[0];\r\n    session.questionOrder.push(current);\r\n    session.pointer += 1;\r\n    session.updatedAt = nowIso();\r\n    record.updatedAt = nowIso();\r\n    await this.saveRecord(record);\r\n    const done = session.pointer >= session.questionOrder.length;\r\n    return jsonResponse({ pointer: session.pointer, done }, 200, origin);\r\n  }\r\n\r\n  // Quiz: end session and return summary (no answers)\r\n  private async handleQuizEnd(userId: string, origin: string | null, sessionId: string): Promise<Response> {\r\n    const record = await this.getRecord(userId);\r\n    const session = record.quizSession;\r\n    if (!session || session.id !== sessionId) return jsonResponse({ error: \"No session\" }, 404, origin);\r\n    session.state = \"ended\";\r\n    session.updatedAt = nowIso();\r\n    record.updatedAt = nowIso();\r\n    await this.saveRecord(record);\r\n    return jsonResponse({\r\n      summary: {\r\n        id: session.id,\r\n        score: session.score,\r\n        coinsEarned: session.coinsEarned,\r\n        lives: session.lives,\r\n        totalQuestions: session.questionOrder.length,\r\n        assistsUsed: session.assistsUsed,\r\n        state: session.state,\r\n      },\r\n      balance: record.coins,\r\n    }, 200, origin);\r\n  }\r\n}\r\n", "import type { Middleware } from \"./common\";\n\nconst drainBody: Middleware = async (request, env, _ctx, middlewareCtx) => {\n\ttry {\n\t\treturn await middlewareCtx.next(request, env);\n\t} finally {\n\t\ttry {\n\t\t\tif (request.body !== null && !request.bodyUsed) {\n\t\t\t\tconst reader = request.body.getReader();\n\t\t\t\twhile (!(await reader.read()).done) {}\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tconsole.error(\"Failed to drain the unused request body.\", e);\n\t\t}\n\t}\n};\n\nexport default drainBody;\n", "import type { Middleware } from \"./common\";\n\ninterface JsonError {\n\tmessage?: string;\n\tname?: string;\n\tstack?: string;\n\tcause?: JsonError;\n}\n\nfunction reduceError(e: any): JsonError {\n\treturn {\n\t\tname: e?.name,\n\t\tmessage: e?.message ?? String(e),\n\t\tstack: e?.stack,\n\t\tcause: e?.cause === undefined ? undefined : reduceError(e.cause),\n\t};\n}\n\n// See comment in `bundle.ts` for details on why this is needed\nconst jsonError: Middleware = async (request, env, _ctx, middlewareCtx) => {\n\ttry {\n\t\treturn await middlewareCtx.next(request, env);\n\t} catch (e: any) {\n\t\tconst error = reduceError(e);\n\t\treturn Response.json(error, {\n\t\t\tstatus: 500,\n\t\t\theaders: { \"MF-Experimental-Error-Stack\": \"true\" },\n\t\t});\n\t}\n};\n\nexport default jsonError;\n", "\t\t\t\timport worker, * as OTHER_EXPORTS from \"C:\\\\Users\\\\user\\\\Documents\\\\project\\\\astra-games\\\\ftses\\\\astra-quiz-dash-main\\\\src\\\\server\\\\src\\\\index.ts\";\n\t\t\t\timport * as __MIDDLEWARE_0__ from \"C:\\\\Users\\\\user\\\\Documents\\\\project\\\\astra-games\\\\ftses\\\\astra-quiz-dash-main\\\\src\\\\server\\\\node_modules\\\\wrangler\\\\templates\\\\middleware\\\\middleware-ensure-req-body-drained.ts\";\nimport * as __MIDDLEWARE_1__ from \"C:\\\\Users\\\\user\\\\Documents\\\\project\\\\astra-games\\\\ftses\\\\astra-quiz-dash-main\\\\src\\\\server\\\\node_modules\\\\wrangler\\\\templates\\\\middleware\\\\middleware-miniflare3-json-error.ts\";\n\n\t\t\t\texport * from \"C:\\\\Users\\\\user\\\\Documents\\\\project\\\\astra-games\\\\ftses\\\\astra-quiz-dash-main\\\\src\\\\server\\\\src\\\\index.ts\";\n\t\t\t\tconst MIDDLEWARE_TEST_INJECT = \"__INJECT_FOR_TESTING_WRANGLER_MIDDLEWARE__\";\n\t\t\t\texport const __INTERNAL_WRANGLER_MIDDLEWARE__ = [\n\t\t\t\t\t\n\t\t\t\t\t__MIDDLEWARE_0__.default,__MIDDLEWARE_1__.default\n\t\t\t\t]\n\t\t\t\texport default worker;", "export type Awaitable<T> = T | Promise<T>;\n// TODO: allow dispatching more events?\nexport type Dispatcher = (\n\ttype: \"scheduled\",\n\tinit: { cron?: string }\n) => Awaitable<void>;\n\nexport type IncomingRequest = Request<\n\tunknown,\n\tIncomingRequestCfProperties<unknown>\n>;\n\nexport interface MiddlewareContext {\n\tdispatch: Dispatcher;\n\tnext(request: IncomingRequest, env: any): Awaitable<Response>;\n}\n\nexport type Middleware = (\n\trequest: IncomingRequest,\n\tenv: any,\n\tctx: ExecutionContext,\n\tmiddlewareCtx: MiddlewareContext\n) => Awaitable<Response>;\n\nconst __facade_middleware__: Middleware[] = [];\n\n// The register functions allow for the insertion of one or many middleware,\n// We register internal middleware first in the stack, but have no way of controlling\n// the order that addMiddleware is run in service workers so need an internal function.\nexport function __facade_register__(...args: (Middleware | Middleware[])[]) {\n\t__facade_middleware__.push(...args.flat());\n}\nexport function __facade_registerInternal__(\n\t...args: (Middleware | Middleware[])[]\n) {\n\t__facade_middleware__.unshift(...args.flat());\n}\n\nfunction __facade_invokeChain__(\n\trequest: IncomingRequest,\n\tenv: any,\n\tctx: ExecutionContext,\n\tdispatch: Dispatcher,\n\tmiddlewareChain: Middleware[]\n): Awaitable<Response> {\n\tconst [head, ...tail] = middlewareChain;\n\tconst middlewareCtx: MiddlewareContext = {\n\t\tdispatch,\n\t\tnext(newRequest, newEnv) {\n\t\t\treturn __facade_invokeChain__(newRequest, newEnv, ctx, dispatch, tail);\n\t\t},\n\t};\n\treturn head(request, env, ctx, middlewareCtx);\n}\n\nexport function __facade_invoke__(\n\trequest: IncomingRequest,\n\tenv: any,\n\tctx: ExecutionContext,\n\tdispatch: Dispatcher,\n\tfinalMiddleware: Middleware\n): Awaitable<Response> {\n\treturn __facade_invokeChain__(request, env, ctx, dispatch, [\n\t\t...__facade_middleware__,\n\t\tfinalMiddleware,\n\t]);\n}\n", "// This loads all middlewares exposed on the middleware object and then starts\n// the invocation chain. The big idea is that we can add these to the middleware\n// export dynamically through wrangler, or we can potentially let users directly\n// add them as a sort of \"plugin\" system.\n\nimport ENTRY, { __INTERNAL_WRANGLER_MIDDLEWARE__ } from \"C:\\\\Users\\\\user\\\\Documents\\\\project\\\\astra-games\\\\ftses\\\\astra-quiz-dash-main\\\\src\\\\server\\\\.wrangler\\\\tmp\\\\bundle-0oruRV\\\\middleware-insertion-facade.js\";\nimport { __facade_invoke__, __facade_register__, Dispatcher } from \"C:\\\\Users\\\\user\\\\Documents\\\\project\\\\astra-games\\\\ftses\\\\astra-quiz-dash-main\\\\src\\\\server\\\\node_modules\\\\wrangler\\\\templates\\\\middleware\\\\common.ts\";\nimport type { WorkerEntrypointConstructor } from \"C:\\\\Users\\\\user\\\\Documents\\\\project\\\\astra-games\\\\ftses\\\\astra-quiz-dash-main\\\\src\\\\server\\\\.wrangler\\\\tmp\\\\bundle-0oruRV\\\\middleware-insertion-facade.js\";\n\n// Preserve all the exports from the worker\nexport * from \"C:\\\\Users\\\\user\\\\Documents\\\\project\\\\astra-games\\\\ftses\\\\astra-quiz-dash-main\\\\src\\\\server\\\\.wrangler\\\\tmp\\\\bundle-0oruRV\\\\middleware-insertion-facade.js\";\n\nclass __Facade_ScheduledController__ implements ScheduledController {\n\treadonly #noRetry: ScheduledController[\"noRetry\"];\n\n\tconstructor(\n\t\treadonly scheduledTime: number,\n\t\treadonly cron: string,\n\t\tnoRetry: ScheduledController[\"noRetry\"]\n\t) {\n\t\tthis.#noRetry = noRetry;\n\t}\n\n\tnoRetry() {\n\t\tif (!(this instanceof __Facade_ScheduledController__)) {\n\t\t\tthrow new TypeError(\"Illegal invocation\");\n\t\t}\n\t\t// Need to call native method immediately in case uncaught error thrown\n\t\tthis.#noRetry();\n\t}\n}\n\nfunction wrapExportedHandler(worker: ExportedHandler): ExportedHandler {\n\t// If we don't have any middleware defined, just return the handler as is\n\tif (\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__ === undefined ||\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__.length === 0\n\t) {\n\t\treturn worker;\n\t}\n\t// Otherwise, register all middleware once\n\tfor (const middleware of __INTERNAL_WRANGLER_MIDDLEWARE__) {\n\t\t__facade_register__(middleware);\n\t}\n\n\tconst fetchDispatcher: ExportedHandlerFetchHandler = function (\n\t\trequest,\n\t\tenv,\n\t\tctx\n\t) {\n\t\tif (worker.fetch === undefined) {\n\t\t\tthrow new Error(\"Handler does not export a fetch() function.\");\n\t\t}\n\t\treturn worker.fetch(request, env, ctx);\n\t};\n\n\treturn {\n\t\t...worker,\n\t\tfetch(request, env, ctx) {\n\t\t\tconst dispatcher: Dispatcher = function (type, init) {\n\t\t\t\tif (type === \"scheduled\" && worker.scheduled !== undefined) {\n\t\t\t\t\tconst controller = new __Facade_ScheduledController__(\n\t\t\t\t\t\tDate.now(),\n\t\t\t\t\t\tinit.cron ?? \"\",\n\t\t\t\t\t\t() => {}\n\t\t\t\t\t);\n\t\t\t\t\treturn worker.scheduled(controller, env, ctx);\n\t\t\t\t}\n\t\t\t};\n\t\t\treturn __facade_invoke__(request, env, ctx, dispatcher, fetchDispatcher);\n\t\t},\n\t};\n}\n\nfunction wrapWorkerEntrypoint(\n\tklass: WorkerEntrypointConstructor\n): WorkerEntrypointConstructor {\n\t// If we don't have any middleware defined, just return the handler as is\n\tif (\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__ === undefined ||\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__.length === 0\n\t) {\n\t\treturn klass;\n\t}\n\t// Otherwise, register all middleware once\n\tfor (const middleware of __INTERNAL_WRANGLER_MIDDLEWARE__) {\n\t\t__facade_register__(middleware);\n\t}\n\n\t// `extend`ing `klass` here so other RPC methods remain callable\n\treturn class extends klass {\n\t\t#fetchDispatcher: ExportedHandlerFetchHandler<Record<string, unknown>> = (\n\t\t\trequest,\n\t\t\tenv,\n\t\t\tctx\n\t\t) => {\n\t\t\tthis.env = env;\n\t\t\tthis.ctx = ctx;\n\t\t\tif (super.fetch === undefined) {\n\t\t\t\tthrow new Error(\"Entrypoint class does not define a fetch() function.\");\n\t\t\t}\n\t\t\treturn super.fetch(request);\n\t\t};\n\n\t\t#dispatcher: Dispatcher = (type, init) => {\n\t\t\tif (type === \"scheduled\" && super.scheduled !== undefined) {\n\t\t\t\tconst controller = new __Facade_ScheduledController__(\n\t\t\t\t\tDate.now(),\n\t\t\t\t\tinit.cron ?? \"\",\n\t\t\t\t\t() => {}\n\t\t\t\t);\n\t\t\t\treturn super.scheduled(controller);\n\t\t\t}\n\t\t};\n\n\t\tfetch(request: Request<unknown, IncomingRequestCfProperties>) {\n\t\t\treturn __facade_invoke__(\n\t\t\t\trequest,\n\t\t\t\tthis.env,\n\t\t\t\tthis.ctx,\n\t\t\t\tthis.#dispatcher,\n\t\t\t\tthis.#fetchDispatcher\n\t\t\t);\n\t\t}\n\t};\n}\n\nlet WRAPPED_ENTRY: ExportedHandler | WorkerEntrypointConstructor | undefined;\nif (typeof ENTRY === \"object\") {\n\tWRAPPED_ENTRY = wrapExportedHandler(ENTRY);\n} else if (typeof ENTRY === \"function\") {\n\tWRAPPED_ENTRY = wrapWorkerEntrypoint(ENTRY);\n}\nexport default WRAPPED_ENTRY;\n"],
  "mappings": "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AAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EACjF;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EACjF;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EACjF;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EACjF;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EACjF;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EACjF;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EACjF;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EACjF;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EACjF;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EACjF;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EACjF;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EACjF;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EACjF;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EACjF;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EACjF;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EACjF;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EACjF;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EACjF;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EACjF;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EACjF;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EACjF;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EACjF;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EACjF;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EACjF;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EACjF;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EACjF;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EACjF;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EACjF;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EACjF;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EACjF;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EACjF;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EACjF;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EACjF;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EACjF;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EACjF;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EAAS;AAAA,EACjF;AAAA,EAAS;AAAA,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",
  "names": ["pool"]
}
